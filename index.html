<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EliudGestor GCA | Enterprise ERP</title>
    
    <link rel="stylesheet" href="styles.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

    <div id="sidebar-overlay" onclick="toggleSidebar()"></div>
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 3000" id="toast-area"></div>

    <div id="login-screen">
        <div class="login-box text-center fade-in">
            <div class="mb-4">
                <div class="bg-primary text-white rounded-3 d-inline-flex align-items-center justify-content-center p-3 mb-3 shadow">
                    <i class="fas fa-cubes fa-2x"></i>
                </div>
                <h3 class="fw-bold text-dark">EliudGestor GCA</h3>
                <p class="text-muted">ERP Industrial Enterprise</p>
            </div>
            <form id="login-form">
                <div class="form-floating mb-3 text-start">
                    <input type="text" class="form-control" id="u-name" required value="admin">
                    <label>Usuário</label>
                </div>
                <div class="form-floating mb-4 text-start">
                    <input type="password" class="form-control" id="u-pass" required value="1234">
                    <label>Senha</label>
                </div>
                <button type="submit" class="btn btn-primary w-100 py-3 fw-bold shadow-lg" id="btn-login">ENTRAR</button>
            </form>
            <div class="mt-4 text-muted small border-top pt-3">Demo: admin / 1234</div>
        </div>
    </div>

    <nav id="sidebar">
        <div class="p-4 border-bottom border-secondary d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center gap-3">
                <i class="fas fa-layer-group fa-lg text-info"></i>
                <div><h6 class="m-0 fw-bold text-white">EliudGestor</h6><small style="opacity:0.6;">GCA TEXTIL</small></div>
            </div>
            <button class="btn btn-sm btn-outline-secondary d-lg-none border-0 text-white" onclick="toggleSidebar()"><i class="fas fa-times fa-lg"></i></button>
        </div>
        <div class="py-3 flex-grow-1 overflow-auto">
            <small class="text-uppercase text-muted fw-bold px-4 mb-2 d-block" style="font-size: 0.7rem;">Módulos</small>
            <a class="nav-link active" onclick="loadView('dashboard')"><i class="fas fa-chart-pie me-3"></i> Dashboard</a>
            <a class="nav-link" onclick="loadView('entrada')"><i class="fas fa-dolly me-3"></i> Entrada (NFe)</a>
            <a class="nav-link" onclick="loadView('estoque')"><i class="fas fa-boxes me-3"></i> Estoque</a>
            <a class="nav-link" onclick="loadView('fichas')"><i class="fas fa-file-alt me-3"></i> Fichas Técnicas</a>
            <div class="my-2 border-top border-secondary opacity-25"></div>
            <a class="nav-link" onclick="loadView('producao')"><i class="fas fa-industry me-3"></i> Produção</a>
            <a class="nav-link" onclick="loadView('acabado')"><i class="fas fa-clipboard-check me-3"></i> Acabados</a>
            <div class="my-2 border-top border-secondary opacity-25"></div>
            <a class="nav-link" onclick="loadView('saida')"><i class="fas fa-shipping-fast me-3"></i> Expedição</a>
        </div>
        <div class="p-3 bg-black bg-opacity-25">
            <button class="btn btn-outline-secondary w-100 text-light btn-sm" onclick="logout()"><i class="fas fa-power-off me-2"></i> Sair</button>
        </div>
    </nav>

    <div class="main-wrapper d-flex flex-column min-vh-100" id="app-content" style="filter: blur(5px);">
        <header class="bg-white border-bottom px-4 py-3 d-flex justify-content-between align-items-center sticky-top shadow-sm">
            <div class="d-flex align-items-center gap-3">
                <button class="btn btn-light d-lg-none text-primary" onclick="toggleSidebar()"><i class="fas fa-bars fa-lg"></i></button>
                <h5 class="m-0 fw-bold text-secondary" id="page-title">Dashboard</h5>
            </div>
            <div class="d-flex align-items-center gap-3">
                <div class="text-end d-none d-md-block line-height-sm">
                    <div class="fw-bold small text-dark">Administrador</div>
                    <small class="text-muted" style="font-size: 0.75rem;">Gerente</small>
                </div>
                <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center fw-bold shadow-sm" style="width: 40px; height: 40px;">AD</div>
            </div>
        </header>

        <div class="p-4 flex-grow-1">

            <div id="view-dashboard" class="view-section fade-in">
                <div class="row g-4 mb-4">
                    <div class="col-md-4"><div class="kpi-box bg-primary"><small class="text-uppercase opacity-75 fw-bold">Matéria Prima</small><h2 class="display-5 fw-bold mb-0" id="kpi-raw">0</h2><i class="fas fa-cubes position-absolute end-0 bottom-0 p-3 opacity-25 fa-3x"></i></div></div>
                    <div class="col-md-4"><div class="kpi-box bg-success"><small class="text-uppercase opacity-75 fw-bold">Acabados</small><h2 class="display-5 fw-bold mb-0" id="kpi-finished">0</h2><i class="fas fa-check-circle position-absolute end-0 bottom-0 p-3 opacity-25 fa-3x"></i></div></div>
                    <div class="col-md-4"><div class="kpi-box" style="background: #6366f1;"><small class="text-uppercase opacity-75 fw-bold">Peso Estoque</small><h2 class="display-5 fw-bold mb-0" id="kpi-weight">0 kg</h2><i class="fas fa-weight-hanging position-absolute end-0 bottom-0 p-3 opacity-25 fa-3x"></i></div></div>
                </div>
                <div class="erp-card h-100"><h5 class="text-primary mb-4">Produção Semanal</h5><div style="height: 300px;"><canvas id="mainChart"></canvas></div></div>
            </div>

            <div id="view-entrada" class="view-section fade-in" style="display: none;">
                <div class="erp-card border-primary border-start border-0 border-top-0 border-end-0 border-bottom-0" style="border-left-width: 5px !important;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="mb-1 fw-bold"><i class="fas fa-file-invoice me-2 text-primary"></i>Entrada NFe</h5>
                        <div>
                            <button class="btn btn-success me-2" onclick="triggerXML()"><i class="fas fa-cloud-upload-alt me-2"></i> XML</button>
                            <button class="btn btn-warning fw-bold text-dark" onclick="startConferenceScanner()"><i class="fas fa-barcode me-2"></i> CONFERIR</button>
                        </div>
                        <input type="file" id="xml-input" hidden accept=".xml" onchange="processXML(this)">
                    </div>
                    <div class="bg-light p-4 rounded-3 border mb-4">
                        <div class="row g-3 align-items-end">
                            <div class="col-md-5">
                                <label class="small fw-bold text-uppercase text-secondary mb-1">Número do Lote</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-white"><i class="fas fa-barcode"></i></span>
                                    <input type="text" id="in-batch" class="form-control fw-bold text-uppercase" placeholder="EX: LOTE-001">
                                    <button class="btn btn-primary" onclick="openScanner('in-batch')"><i class="fas fa-camera"></i></button>
                                </div>
                            </div>
                            <div class="col-md-7 text-end"><button class="btn btn-outline-primary" onclick="openManualModal()"><i class="fas fa-plus me-2"></i> Manual</button></div>
                        </div>
                    </div>
                    <div class="table-responsive border rounded-3 mb-4" style="max-height: 400px; overflow-y: auto;">
                        <table class="table table-erp table-hover mb-0 align-middle">
                            <thead class="table-light sticky-top">
                                <tr>
                                    <th class="text-center">Status</th>
                                    <th>Item / Código</th>
                                    <th class="text-center">Qtd</th>
                                    <th class="text-center">Peso Tot</th>
                                    <th class="text-center text-primary">Unitário</th>
                                    <th class="text-end">Ação</th>
                                </tr>
                            </thead>
                            <tbody id="temp-entry-body"><tr><td colspan="6" class="text-center py-5 text-muted">Aguardando itens...</td></tr></tbody>
                        </table>
                    </div>
                    <div class="d-flex justify-content-end gap-3 pt-3 border-top">
                        <button class="btn btn-outline-danger px-4" onclick="clearEntry()">Cancelar</button>
                        <button class="btn btn-success px-4 fw-bold shadow-sm" onclick="commitEntry()"><i class="fas fa-save me-2"></i> PROCESSAR ENTRADA</button>
                    </div>
                </div>
            </div>

            <div id="view-fichas" class="view-section fade-in" style="display: none;">
                <div class="erp-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="fw-bold mb-0"><i class="fas fa-file-alt me-2 text-primary"></i>Fichas Técnicas</h5>
                        <div>
                            <button class="btn btn-success btn-sm me-2" onclick="Recipes.triggerImport()"><i class="fas fa-file-upload me-2"></i> Importar XML</button>
                            <input type="file" id="ft-xml-input" hidden accept=".xml" onchange="Recipes.processImport(this)">
                            <button class="btn btn-primary btn-sm" onclick="Recipes.addManual()"><i class="fas fa-plus me-2"></i> Nova Manual</button>
                        </div>
                    </div>
                    <div class="table-responsive border rounded-3">
                        <table class="table table-erp table-hover mb-0">
                            <thead><tr><th>ID</th><th>Nome do Produto</th><th class="text-center">Ingredientes</th><th class="text-end">Ação</th></tr></thead>
                            <tbody id="recipes-body"></tbody>
                        </table>
                    </div>
                    <div class="alert alert-info small mt-3 mb-0"><i class="fas fa-info-circle me-1"></i> Estas receitas definem o consumo na produção.</div>
                </div>
            </div>

            <div id="view-producao" class="view-section fade-in" style="display: none;">
                <div class="row g-4">
                    <div class="col-lg-5">
                        <div class="erp-card h-100 border-primary" style="border-left-width: 5px !important;">
                            <h5 class="fw-bold mb-4"><i class="fas fa-industry me-2"></i>Ordem de Produção</h5>
                            <div class="mb-4">
                                <label class="small fw-bold text-secondary mb-1">1. FICHA TÉCNICA (Produto)</label>
                                <select id="recipe-select" class="form-select form-select-lg fw-bold text-primary" onchange="calcProduction()"><option value="">Selecione...</option></select>
                            </div>
                            <div class="mb-4">
                                <label class="small fw-bold text-secondary mb-1">2. LOTE DE ORIGEM (MP)</label>
                                <div class="input-group">
                                    <select id="prod-batch-select" class="form-select" onchange="calcProduction()"><option value="">Selecione Lote...</option></select>
                                    <button class="btn btn-outline-secondary" onclick="Production.refreshBatches()"><i class="fas fa-sync-alt"></i></button>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label class="small fw-bold text-secondary mb-1">3. QTD PLANEJADA</label>
                                <div class="input-group input-group-lg">
                                    <input type="number" id="prod-qty" class="form-control fw-bold text-dark" placeholder="0" oninput="calcProduction()">
                                    <span class="input-group-text">Unidades</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-7">
                        <div class="erp-card h-100">
                            <h5 class="fw-bold mb-3"><i class="fas fa-calculator me-2"></i>Consumo Previsto</h5>
                            <div class="table-responsive border rounded-3 mb-3" style="max-height: 250px; overflow-y: auto;">
                                <table class="table table-sm table-striped mb-0 small">
                                    <thead class="table-light sticky-top"><tr><th>Ingrediente</th><th class="text-center">Unitário</th><th class="text-center">Total Nec.</th><th class="text-end">Status</th></tr></thead>
                                    <tbody id="prod-calc-body"><tr><td colspan="4" class="text-center py-5 text-muted">Configure a ordem ao lado...</td></tr></tbody>
                                </table>
                            </div>
                            <div class="bg-light p-3 rounded border mb-3">
                                <h6 class="fw-bold text-dark border-bottom pb-2 mb-3">Reporte Final (Realidade)</h6>
                                <div class="row g-2 mb-3">
                                    <div class="col-6"><label class="small fw-bold text-secondary">Qtd Planejada</label><input type="text" id="planned-qty" class="form-control bg-white" readonly value="0"></div>
                                    <div class="col-6"><label class="small fw-bold text-success">Qtd REAL Produzida</label><input type="number" id="real-qty" class="form-control border-success fw-bold" placeholder="Ex: 990"></div>
                                </div>
                                <label class="small fw-bold text-danger mb-2"><i class="fas fa-recycle me-1"></i> Resíduos (Kg)</label>
                                <div class="card p-2 border-danger border-opacity-25 bg-white">
                                    <div class="row g-2">
                                        <div class="col-6"><label class="small text-muted" style="font-size:0.7em;">Ráfia (PP)</label><input type="number" step="0.01" id="waste-pp" class="form-control form-control-sm border-danger" placeholder="0.0"></div>
                                        <div class="col-6"><label class="small text-muted" style="font-size:0.7em;">Liner (PE)</label><input type="number" step="0.01" id="waste-pe" class="form-control form-control-sm border-danger" placeholder="0.0"></div>
                                        <div class="col-6"><label class="small text-muted" style="font-size:0.7em;">Fios/Alças</label><input type="number" step="0.01" id="waste-mix" class="form-control form-control-sm border-danger" placeholder="0.0"></div>
                                        <div class="col-6"><label class="small text-muted" style="font-size:0.7em;">Lixo</label><input type="number" step="0.01" id="waste-trash" class="form-control form-control-sm border-secondary" placeholder="0.0"></div>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-secondary w-100 py-3 fw-bold shadow-sm" id="btn-finish-prod" disabled onclick="finishProduction()"><i class="fas fa-check-circle me-2"></i> ENCERRAR ORDEM</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-estoque" class="view-section fade-in" style="display: none;">
                <div class="erp-card">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="mb-0 fw-bold">Estoque de Matéria Prima</h5>
                        <button class="btn btn-outline-success btn-sm" onclick="exportExcel()"><i class="fas fa-file-excel me-2"></i> Excel</button>
                    </div>
                    <div class="table-responsive border rounded-3">
                        <table class="table table-erp table-striped table-hover mb-0">
                            <thead><tr><th>Lote</th><th>Item</th><th>Qtd Disp.</th><th>Peso Tot.</th><th>Peso Unit.</th><th>Ação</th></tr></thead>
                            <tbody id="stock-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="view-acabado" class="view-section fade-in" style="display: none;">
                <div class="erp-card">
                    <h5 class="mb-4 fw-bold">Histórico de Produção</h5>
                    <div class="table-responsive border rounded-3">
                        <table class="table table-erp table-hover mb-0">
                            <thead><tr><th>Data</th><th>Lote MP</th><th>Produto</th><th>Qtd Real</th><th>Perda Total</th></tr></thead>
                            <tbody id="finished-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="view-saida" class="view-section fade-in" style="display: none;">
                <div class="erp-card border-danger border-start border-0 border-top-0 border-end-0 border-bottom-0" style="border-left-width: 5px !important;">
                    <h5 class="text-danger mb-4 fw-bold"><i class="fas fa-truck-loading me-2"></i>Expedição</h5>
                    <div class="mb-3">
                        <label class="small fw-bold">Selecione Lote Acabado</label>
                        <select id="dispatch-select" class="form-select form-select-lg"></select>
                    </div>
                    <div class="row g-3">
                        <div class="col-md-6"><label class="small fw-bold">Quantidade</label><input type="number" id="dispatch-qty" class="form-control" placeholder="0"></div>
                        <div class="col-md-6"><label class="small fw-bold">Cliente</label><input type="text" id="dispatch-client" class="form-control" placeholder="Cliente XYZ"></div>
                    </div>
                    <button class="btn btn-danger w-100 mt-4 py-3 fw-bold" onclick="processDispatch()">CONFIRMAR SAÍDA</button>
                </div>
            </div>

        </div>

        <footer class="bg-white border-top py-3 mt-auto">
            <div class="container-fluid px-4">
                <div class="d-flex align-items-center justify-content-between small">
                    <div class="text-muted">
                        &copy; 2025 <strong>DevEliud Systems</strong>. Todos os direitos reservados.
                    </div>
                    <div>
                        <a href="#" class="text-muted text-decoration-none me-3">Privacidade</a>
                        <a href="#" class="text-muted text-decoration-none">Suporte</a>
                    </div>
                </div>
            </div>
        </footer>
        </div>

    <div class="modal fade" id="manualItemModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Novo Item</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form id="manual-form"><div class="mb-3"><label>Descrição</label><input type="text" id="m-desc" class="form-control" required></div><div class="row g-2 mb-3"><div class="col"><label>Qtd</label><input type="number" id="m-qty" class="form-control" required></div><div class="col"><label>Peso Total (kg)</label><input type="number" step="0.01" id="m-weight" class="form-control"></div></div><div class="mb-3"><label>Tipo</label><select id="m-type" class="form-select"><option value="KIT">KIT</option><option value="COMUM">COMUM</option></select></div><button type="submit" class="btn btn-primary w-100">Salvar</button></form></div></div></div></div>
    
    <div class="modal fade" id="scannerModal" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content bg-dark"><div class="modal-body p-0"><div id="reader" style="width: 100%;"></div></div></div></div></div>

    <div class="modal fade" id="recipeEditModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title fw-bold" id="recipe-edit-title">Editar Ficha Técnica</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="recipe-edit-index">
                    <div class="mb-3">
                        <label class="small fw-bold">Nome do Produto</label>
                        <input type="text" id="recipe-edit-name" class="form-control fw-bold">
                    </div>
                    <div class="table-responsive border rounded">
                        <table class="table table-sm mb-0">
                            <thead class="table-light"><tr><th>Ingrediente (Busca no Estoque)</th><th style="width:100px">Consumo</th><th style="width:100px">Unid.</th><th></th></tr></thead>
                            <tbody id="recipe-edit-body"></tbody>
                        </table>
                    </div>
                    <button class="btn btn-sm btn-outline-primary mt-2" onclick="Recipes.addItemToModal()"><i class="fas fa-plus"></i> Adicionar Ingrediente</button>
                </div>
                <div class="modal-footer bg-light">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success fw-bold px-4" onclick="Recipes.saveEdited()">SALVAR ALTERAÇÕES</button>
                </div>
            </div>
        </div>
    </div>

    <script src="main.js?v=8.2"></script>
    <footer class="site-footer">
        <div class="container d-flex justify-content-between align-items-center">
            
            <div>
                <strong>DevEliud</strong>
                <div class="small text-muted">Desenvolvido por DevEliud</div>
            </div>
            <div class="text-end">
                <a href="tel:+5549991839170" class="footer-phone">+55 (49)991839170</a>
            </div>
        </div>
    </footer>
</body>
</html>